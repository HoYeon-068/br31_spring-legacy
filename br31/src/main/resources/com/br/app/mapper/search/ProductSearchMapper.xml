<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.br.app.mapper.search.ProductSearchMapper">

  <select id="selectSearchList" resultType="com.br.app.domain.search.ProductDTO">
    SELECT
      p.products_id    AS productsId,
      p.category_id    AS categoryId,
      p.product_name   AS productName,
      p.english_name   AS englishName,
      p.sub_title      AS subTitle,
      p.description    AS description,
      p.product_status AS productStatus,
      p.img_path       AS imgPath,
      p.bg_color       AS bgColor,
      p.span_color     AS spanColor,
      p.poster_path    AS posterPath,
      p.price          AS price,
      p.release_date   AS releaseDate
    FROM products p
    <where>
      <if test="keyword != null and keyword != ''">
        AND p.product_name LIKE '%' || #{keyword} || '%'
      </if>

      <if test="categoryId != null">
        AND p.category_id = #{categoryId}
      </if>
    </where>
    ORDER BY p.products_id DESC
  </select>

  <select id="selectSearchCount" resultType="int">
    SELECT COUNT(*)
    FROM products p
    <where>
      <if test="keyword != null and keyword != ''">
        AND p.product_name LIKE '%' || #{keyword} || '%'
      </if>

      <if test="categoryId != null">
        AND p.category_id = #{categoryId}
      </if>
    </where>
  </select>

</mapper>
